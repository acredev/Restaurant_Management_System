<%@page import="java.sql.PreparedStatement"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
    
<%@ page import="leekangjo.fileDAOtest" %>
<%@ page import="java.io.File" %>

<%@ page import="com.oreilly.servlet.multipart.DefaultFileRenamePolicy" %>
<%@ page import="com.oreilly.servlet.MultipartRequest" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<%
	request.setCharacterEncoding("UTF-8");
	String store_num = request.getParameter("store_num");
	String menu_name = request.getParameter("menu_name");
	String menu_price = request.getParameter("menu_price");
	String uploadDir = this.getClass().getResource("").getPath();
	uploadDir = uploadDir.substring(1, uploadDir.indexOf(".metadata")) + "leekangjo/WebContent/img/store_menu/" + store_num;
	
	int maxSize = 1024 * 1024 * 100;
	String encoding = "UTF-8";
	
	MultipartRequest multipartRequest = new MultipartRequest(request, uploadDir, maxSize, encoding, new DefaultFileRenamePolicy());
	
	String img_name = multipartRequest.getOriginalFileName("file");
	String img_realName = multipartRequest.getFilesystemName("file");
	String img_route = "leekangjo/WebContent/img/store_menu/" + store_num + "/img_realName";
	try
	{
		//JDBC 드라이버 연결
		Class.forName("com.mysql.jdbc.Driver");
		String db_address = "jdbc:mysql://127.0.0.1:3306/kyungmin_store";
		String db_username = "root";
		String db_pwd = "root";
		connection = DriverManager.getConnection(db_address, db_username, db_pwd);
		
		String insertQuery = "INSERT INTO kyungmin_store.store_menu VALUES (?, ?, ?, ?, ?, ?)";
		PreparedStatement psmt = connection.prepareStatement(insertQuery);
		psmt.setString (1, store_num);
		psmt.setString (2, menu_name);
		psmt.setString (3, menu_price);
		psmt.setString (4, img_name);
		psmt.setString (5, img_realName);
		psmt.setString (6, img_route);
	}
	catch (Exception ex)
	{
		out.print(ex.getMessage());
	}
%>
</body>
</html>